# 图书管理系统需求文档

## 1. 项目概述

### 1.1 项目背景
本项目旨在开发一个图书管理系统，支持图书信息管理、位置管理和图书借阅功能。系统通过扫码枪识别图书一维码，简化图书录入和借阅流程。

### 1.2 项目目标
- 实现图书信息的快速录入和管理
- 支持三级位置信息（区域、书架、层数）的维护
- 提供便捷的图书借阅功能，支持手机端操作
- 通过扫码枪和手机扫码提升操作效率

### 1.3 技术栈
- **后端**: Go 1.25.3 + Hertz框架
- **数据库**: MySQL 8.4.5
- **前端**: Vue3

## 2. 功能需求

### 2.1 图书管理模块

#### 2.1.1 图书信息录入
- **功能描述**: 通过扫码枪扫描图书一维码，录入图书信息
- **输入项**:
  - 一维码（通过扫码枪扫描，自动填充）
  - 书名（必填）
  - 数量（必填，整数）
  - 在库数量（非必填，不填时，与数量相同）
  - 位置（可选，下拉选择，三级联动：区域 -> 书架 -> 层数）
  - 价格（可选，支持小数）
  - 备注（可选，文本）
- **业务规则**:
  - 一维码作为图书的唯一标识
  - 在库数量不能大于数量
  - 在库数量默认为数量值
  - 支持修改已录入的图书信息

#### 2.1.2 图书信息查询
- **功能描述**: 支持按书名、一维码、位置等条件查询图书
- **查询条件**:
  - 书名（模糊匹配）
  - 一维码（精确匹配）
  - 位置（区域、书架、层数）
  - 在库状态（在库数量/已借出数量和借阅人查询）
- **显示信息**: 书名、一维码、数量、在库数量、位置、价格、备注

#### 2.1.3 图书信息修改
- **功能描述**: 修改已录入的图书信息
- **限制**: 一维码不可修改（作为唯一标识）

#### 2.1.4 图书信息删除
- **功能描述**: 删除图书记录
- **业务规则**: 如果图书存在借阅记录，需要提示用户

### 2.2 位置管理模块

#### 2.2.1 位置信息结构
位置采用三级结构：
- **一级**: 区域（如：A区、B区、C区）
- **二级**: 书架（如：1号书架、2号书架）
- **三级**: 层数（如：第1层、第2层、第3层）

#### 2.2.2 区域管理
- **功能描述**: 维护区域信息
- **操作**: 新增、修改、删除区域
- **字段**: 区域名称（必填，唯一）

#### 2.2.3 书架管理
- **功能描述**: 在指定区域下维护书架信息
- **操作**: 新增、修改、删除书架
- **字段**: 
  - 书架名称（必填）
  - 所属区域（必填，下拉选择）
- **业务规则**: 书架名称在同一区域内唯一

#### 2.2.4 层数管理
- **功能描述**: 在指定书架下维护层数信息
- **操作**: 新增、修改、删除层数
- **字段**:
  - 层数名称（必填）
  - 所属书架（必填，下拉选择）
- **业务规则**: 层数名称在同一书架下唯一

#### 2.2.5 位置三级联动
- **功能描述**: 在图书录入和查询时，位置选择支持三级联动
- **交互流程**:
  1. 选择区域
  2. 根据区域加载对应的书架列表
  3. 选择书架
  4. 根据书架加载对应的层数列表
  5. 选择层数

### 2.3 借阅管理模块

#### 2.3.1 借阅流程
1. **用户信息录入**
   - 用户通过手机扫码进入借阅页面，由系统创建二维码展示在前端
   - 填写姓名（必填）
   - 填写电话（必填，需验证格式）

2. **图书扫码借阅**
   - 通过扫码枪扫描图书一维码
   - 无需系统验证：
        不用校验图书是否存在，库存数量是否足够
   - 更新图书在库数量（在库数量 - 1）
   - 显示已借阅图书列表（如果没有录入图书信息，展示一维码信息即可）

3. **连续借阅**
   - 用户可以连续扫描多个图书
   - 每次扫码后，图书自动加入借阅列表
   - 显示当前借阅的图书总数和图书信息的列表（如果没有录入图书信息，展示一维码信息即可）

4. **完成借阅**
   - 用户点击"退出"或"完成借阅"按钮
   - 系统保存借阅记录
   - 记录信息包括：
     - 借阅人姓名
     - 借阅人电话
     - 借阅时间
     - 借阅的图书列表（一维码）
   - 跳转到二维码页面，方便下一个借阅人进行借阅

#### 2.3.2 借阅记录查询
- **功能描述**: 无需登录查询历史借阅记录
- **查询条件**:
  - 借阅人姓名（精确匹配）
  - 借阅人电话（精确匹配）
- **显示信息**: 借阅人姓名、电话、正在借阅图书列表及其时间

#### 2.3.3 归还功能
- **功能描述**: 归还已借阅的图书
- **操作流程**:
  1. 扫描图书一维码
  2. 查找该图书的借阅记录
  3. 更新图书在库数量（在库数量 + 1）
  4. 更新借阅记录状态为已归还
  5. 记录归还时间

## 3. 非功能需求

### 3.1 性能需求
- 扫码响应时间 < 500ms
- 页面加载时间 < 2s
- 支持并发用户数 ≥ 50

### 3.2 兼容性需求
- 支持主流浏览器（Chrome、Firefox、Safari、Edge）
- 支持移动端浏览器（iOS Safari、Android Chrome）
- 扫码枪兼容标准USB HID设备

### 3.3 可用性需求
- 界面简洁直观，操作流程清晰
- 支持键盘快捷键操作
- 扫码后自动聚焦到下一个输入框

### 3.4 安全性需求
- 输入数据验证和过滤
- SQL注入防护
- XSS攻击防护

## 4. 数据库设计（如有偏差，以需求为准，修改表设计和API）

### 4.1 数据库表结构

#### 4.1.1 区域表 (area)
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 区域ID |
| name | VARCHAR(50) | NOT NULL, UNIQUE | 区域名称 |
| created_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### 4.1.2 书架表 (bookshelf)
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 书架ID |
| area_id | BIGINT | NOT NULL, FOREIGN KEY(area_id) REFERENCES area(id) | 所属区域ID |
| name | VARCHAR(50) | NOT NULL | 书架名称 |
| created_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| UNIQUE KEY(area_id, name) | | | 同一区域内书架名称唯一 |

#### 4.1.3 层数表 (shelf_layer)
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 层数ID |
| bookshelf_id | BIGINT | NOT NULL, FOREIGN KEY(bookshelf_id) REFERENCES bookshelf(id) | 所属书架ID |
| name | VARCHAR(50) | NOT NULL | 层数名称 |
| created_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| UNIQUE KEY(bookshelf_id, name) | | | 同一书架下层数名称唯一 |

#### 4.1.4 图书表 (book)
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 图书ID |
| barcode | VARCHAR(100) | NOT NULL, UNIQUE | 一维码（唯一标识） |
| name | VARCHAR(200) | NOT NULL | 书名 |
| quantity | INT | NOT NULL, DEFAULT 0 | 总数量 |
| in_stock | INT | NOT NULL, DEFAULT 0 | 在库数量 |
| shelf_layer_id | BIGINT | FOREIGN KEY(shelf_layer_id) REFERENCES shelf_layer(id) | 位置ID（层数ID） |
| price | DECIMAL(10,2) | | 价格 |
| remark | TEXT | | 备注 |
| created_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| CHECK(in_stock <= quantity) | | | 在库数量不能大于总数量 |

#### 4.1.5 借阅记录表 (borrow_record)
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 借阅记录ID |
| borrower_name | VARCHAR(50) | NOT NULL | 借阅人姓名 |
| borrower_phone | VARCHAR(20) | NOT NULL | 借阅人电话 |
| borrow_time | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 借阅时间 |
| status | TINYINT | NOT NULL, DEFAULT 1 | 状态（1:借出，2:已归还） |
| created_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### 4.1.6 借阅明细表 (borrow_detail)
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 明细ID |
| borrow_record_id | BIGINT | NOT NULL, FOREIGN KEY(borrow_record_id) REFERENCES borrow_record(id) | 借阅记录ID |
| book_id | BIGINT | NOT NULL, FOREIGN KEY(book_id) REFERENCES book(id) | 图书ID |
| barcode | VARCHAR(100) | NOT NULL | 图书一维码（冗余字段，便于查询） |
| created_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |

### 4.2 索引设计
- `book.barcode`: UNIQUE INDEX（用于快速查询图书）
- `book.shelf_layer_id`: INDEX（用于按位置查询）
- `borrow_record.borrower_phone`: INDEX（用于按电话查询）
- `borrow_record.borrow_time`: INDEX（用于按时间范围查询）
- `borrow_detail.borrow_record_id`: INDEX（用于查询借阅明细）
- `borrow_detail.barcode`: INDEX（用于按一维码查询借阅记录）

## 5. API设计

### 5.1 图书管理API

#### 5.1.1 创建图书
- **接口**: `POST /api/v1/books`
- **请求体**:
```json
{
  "barcode": "9787111234567",
  "name": "Go语言程序设计",
  "quantity": 10,
  "in_stock": 10,
  "shelf_layer_id": 1,
  "price": 89.00,
  "remark": "技术类图书"
}
```
- **响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "barcode": "9787111234567",
    "name": "Go语言程序设计",
    "quantity": 10,
    "in_stock": 10,
    "shelf_layer_id": 1,
    "price": 89.00,
    "remark": "技术类图书",
    "created_at": "2024-01-01 10:00:00",
    "updated_at": "2024-01-01 10:00:00"
  }
}
```

#### 5.1.2 查询图书列表
- **接口**: `GET /api/v1/books`
- **查询参数**:
  - `name`: 书名（模糊匹配）
  - `barcode`: 一维码（精确匹配）
  - `area_id`: 区域ID
  - `bookshelf_id`: 书架ID
  - `shelf_layer_id`: 层数ID
  - `in_stock_status`: 在库状态（1:在库，2:已借出）
  - `page`: 页码（默认1）
  - `page_size`: 每页数量（默认20）
- **响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "barcode": "9787111234567",
        "name": "Go语言程序设计",
        "quantity": 10,
        "in_stock": 8,
        "shelf_layer_id": 1,
        "shelf_layer_name": "A区-1号书架-第1层",
        "price": 89.00,
        "remark": "技术类图书"
      }
    ],
    "total": 100,
    "page": 1,
    "page_size": 20
  }
}
```

#### 5.1.3 根据一维码查询图书
- **接口**: `GET /api/v1/books/barcode/:barcode`
- **响应**: 同创建图书响应格式

#### 5.1.4 更新图书信息
- **接口**: `PUT /api/v1/books/:id`
- **请求体**: 同创建图书（所有字段可选）
- **响应**: 同创建图书响应格式

#### 5.1.5 删除图书
- **接口**: `DELETE /api/v1/books/:id`
- **响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### 5.2 位置管理API

#### 5.2.1 区域管理
- **创建区域**: `POST /api/v1/areas`
- **查询区域列表**: `GET /api/v1/areas`
- **更新区域**: `PUT /api/v1/areas/:id`
- **删除区域**: `DELETE /api/v1/areas/:id`

#### 5.2.2 书架管理
- **创建书架**: `POST /api/v1/bookshelves`
- **查询书架列表**: `GET /api/v1/bookshelves?area_id=1`
- **更新书架**: `PUT /api/v1/bookshelves/:id`
- **删除书架**: `DELETE /api/v1/bookshelves/:id`

#### 5.2.3 层数管理
- **创建层数**: `POST /api/v1/shelf-layers`
- **查询层数列表**: `GET /api/v1/shelf-layers?bookshelf_id=1`
- **更新层数**: `PUT /api/v1/shelf-layers/:id`
- **删除层数**: `DELETE /api/v1/shelf-layers/:id`

#### 5.2.4 位置三级联动查询
- **接口**: `GET /api/v1/locations/tree`
- **响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "A区",
      "bookshelves": [
        {
          "id": 1,
          "name": "1号书架",
          "shelf_layers": [
            {
              "id": 1,
              "name": "第1层"
            }
          ]
        }
      ]
    }
  ]
}
```

### 5.3 借阅管理API

#### 5.3.1 创建借阅记录
- **接口**: `POST /api/v1/borrow`
- **请求体**:
```json
{
  "borrower_name": "张三",
  "borrower_phone": "13800138000",
  "barcodes": ["9787111234567", "9787111234568"]
}
```
- **响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "borrower_name": "张三",
    "borrower_phone": "13800138000",
    "borrow_time": "2024-01-01 10:00:00",
    "books": [
      {
        "id": 1,
        "barcode": "9787111234567",
        "name": "Go语言程序设计"
      }
    ]
  }
}
```

#### 5.3.2 扫码借阅（单本）
- **接口**: `POST /api/v1/borrow/scan`
- **请求体**:
```json
{
  "barcode": "9787111234567"
}
```
- **响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "barcode": "9787111234567",
    "name": "Go语言程序设计",
    "in_stock": 8,
    "can_borrow": true
  }
}
```
- **错误响应**（图书不存在或不在库）:
```json
{
  "code": 400,
  "message": "图书不存在或已全部借出",
  "data": null
}
```

#### 5.3.3 查询借阅记录列表
- **接口**: `GET /api/v1/borrow/records`
- **查询参数**:
  - `borrower_name`: 借阅人姓名（模糊匹配）
  - `borrower_phone`: 借阅人电话（精确匹配）
  - `barcode`: 图书一维码（精确匹配）
  - `start_time`: 开始时间
  - `end_time`: 结束时间
  - `page`: 页码
  - `page_size`: 每页数量
- **响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "borrower_name": "张三",
        "borrower_phone": "13800138000",
        "borrow_time": "2024-01-01 10:00:00",
        "status": 1,
        "books": [
          {
            "barcode": "9787111234567",
            "name": "Go语言程序设计"
          }
        ]
      }
    ],
    "total": 50,
    "page": 1,
    "page_size": 20
  }
}
```

### 5.4 统一响应格式
```json
{
  "code": 200,        // 状态码：200成功，400客户端错误，500服务器错误
  "message": "success", // 提示信息
  "data": {}          // 数据内容
}
```

## 6. 前端页面设计

### 6.1 PC端页面

#### 6.1.1 图书管理页面
- **路径**: `/books`
- **功能**:
  - 图书列表展示（表格形式）
  - 搜索栏（书名、一维码、位置）
  - 新增图书按钮
  - 编辑、删除操作
- **布局**: 顶部搜索栏 + 操作按钮，下方表格列表

#### 6.1.2 图书录入/编辑页面
- **路径**: `/books/add` 或 `/books/edit/:id`
- **表单字段**:
  - 一维码输入框（支持扫码枪输入，自动聚焦）
  - 书名输入框
  - 数量输入框（数字）
  - 在库数量输入框（数字，默认等于数量）
  - 位置三级联动下拉框
  - 价格输入框（数字，小数）
  - 备注文本域
- **交互**: 扫码后自动聚焦到书名输入框

#### 6.1.3 位置管理页面
- **路径**: `/locations`
- **功能**:
  - 区域管理标签页
  - 书架管理标签页
  - 层数管理标签页
  - 每个标签页包含列表和新增/编辑/删除功能

### 6.2 移动端页面

#### 6.2.1 借阅首页
- **路径**: `/borrow`
- **功能**:
  - 用户信息表单（姓名、电话）
  - 扫码借阅区域
  - 已借阅图书列表
  - 完成借阅按钮
- **布局**: 顶部表单，中间扫码区域，下方图书列表，底部完成按钮

#### 6.2.2 借阅成功页面
- **路径**: `/borrow/success`
- **功能**: 显示借阅成功信息，返回首页按钮

### 6.3 公共组件

#### 6.3.1 位置选择组件
- **功能**: 三级联动下拉选择
- **Props**: 
  - `value`: 当前选中的层数ID
  - `onChange`: 选择变化回调

#### 6.3.2 扫码输入组件
- **功能**: 支持扫码枪输入，自动聚焦
- **Props**:
  - `value`: 输入值
  - `onChange`: 值变化回调
  - `onScan`: 扫码完成回调
  - `placeholder`: 占位符

## 7. 开发计划

### 7.1 第一阶段：基础功能
1. 数据库设计和创建
2. 后端基础框架搭建
3. 位置管理模块（区域、书架、层数）
4. 图书管理模块（增删改查）

### 7.2 第二阶段：借阅功能
1. 借阅API开发
2. 移动端借阅页面开发
3. 借阅记录查询功能

### 7.3 第三阶段：优化和完善
1. 性能优化
2. 错误处理完善
3. 用户体验优化
4. 测试和bug修复

## 8. 注意事项

### 8.1 扫码枪集成
- 扫码枪通常作为USB HID键盘设备，输入到当前聚焦的输入框
- 需要在输入框添加自动聚焦功能
- 扫码后通常以回车或Tab键结束，需要监听这些事件

### 8.2 数据验证
- 一维码格式验证
- 电话号码格式验证
- 数量验证（不能为负数，在库数量不能大于总数量）
- 价格验证（不能为负数）

### 8.3 事务处理
- 借阅操作需要事务保证数据一致性
- 更新图书在库数量时需要考虑并发情况

### 8.4 错误处理
- 图书不存在
- 图书已全部借出
- 一维码重复
- 位置信息不存在

## 9. 后续扩展功能（可选）

1. **归还功能**: 实现图书归还，更新在库数量
2. **借阅期限**: 设置借阅期限，超期提醒
3. **统计报表**: 借阅统计、图书统计等
4. **批量操作**: 批量导入图书、批量借阅等
5. **通知功能**: 借阅到期提醒、归还提醒等





